---
title: DIY VCM
categories: [Components]
tags: [canbus, vcm, electrical, software]
author: lhelge
---

# DIY VCM (Vehicle Control Module)
While re-using all power electronics components from the donor cars makes sense. My idea is to create a DIY version of what Nissan call a VCM, so I'll stick with that nomenclature here as well. The VCM is the control unit that manage all main functions of the vecicle and control all other components.

The easiest way to follow the development is through this [GitHub](https://github.com/aphid-ev/vehicle-controller) repository that will contain both the hardware and firmware.

## Safety
Since this VCM will be used to control a car moving at high speeds and the electrical system contain dangerously high voltages, safety is very important. The VCM will support the overall safety. There are two major things that need to be managed by the safety system:
- Traction torque
- High voltages

### Safe state
In case of a critical failure the car will be taken to a safe state by disconnecting the high power supply through the battery contactors and the 12 V logic feed to the traction inverter. This will both prevent the motor/inverter from producing torque and remove the risk of electrical injuries.

### VCM safety design
The VCM will have dual microcontrollers where one will be running the main application and one will be responsible for monitoring critical signals and that the application in the main MCU is executing as expected. The main and monitor applications will also communicate through a serial connection.

- Both MCU's will read and cross-check the dual channel input from the accelerator pedal
- The monitoring MCU will have read access to the EV-CAN bus and monitor that the torque request from the main application is reasonable
- The monitor MCU will control the high-side switch for the pre-charge- and main-contactors and the inverter logic power.
- The main MCU will controll the low-side switch of the pre-charge and main-contactors.
- The main MCU will send watchdog counters over the serial port
- The monitor MCU will be able to disable the EV-CAN transciever and as a final option reset the main MCU.

## Hardware
The PCB is created in the open source [KiCad](https://www.kicad.org/) software.

### Enclosure
The idea is to use the pretty robust ModICE ME-MX 24 enclosure.

### Microcontrollers
The main formware will run in an STM32F405RB microcontroller and there will be a smaller STM32F031K6 for monitoring the main application.

### I/O
*TBD*

## Firmware
The firmware will be developed using the [Rust](https://www.rust-lang.org/) programming language. Both because it provides a lot of nice security features and it is very nice to work with.

### Bootloader

### Monitor application

### Main application